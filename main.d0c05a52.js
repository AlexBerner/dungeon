parcelRequire=function(e,r,n,t){var i="function"==typeof parcelRequire&&parcelRequire,o="function"==typeof require&&require;function u(n,t){if(!r[n]){if(!e[n]){var f="function"==typeof parcelRequire&&parcelRequire;if(!t&&f)return f(n,!0);if(i)return i(n,!0);if(o&&"string"==typeof n)return o(n);var c=new Error("Cannot find module '"+n+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[n][1][r]||r};var l=r[n]=new u.Module(n);e[n][0].call(l.exports,p,l,l.exports,this)}return r[n].exports;function p(e){return u(p.resolve(e))}}u.isParcelRequire=!0,u.Module=function(e){this.id=e,this.bundle=u,this.exports={}},u.modules=e,u.cache=r,u.parent=i,u.register=function(r,n){e[r]=[function(e,r){r.exports=n},{}]};for(var f=0;f<n.length;f++)u(n[f]);if(n.length){var c=u(n[n.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=c:"function"==typeof define&&define.amd?define(function(){return c}):t&&(this[t]=c)}return u}({"B/l8":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=exports.tiles=Object.freeze({blank:0,wall:1,floor:2,door:3,stairsUp:4,stairsDown:5});
},{}],"U5Xy":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Room=void 0;var e=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),t=require("./tiles");function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=exports.Room=function(){function s(e,r){i(this,s),this.size={x:e,y:r},this.pos={x:0,y:0},this.tiles=[];for(var o=0;o<this.size.y;o++){for(var n=[],a=0;a<this.size.x;a++)0===o||o===this.size.y-1||0===a||a===this.size.x-1?n.push(t.tiles.wall):n.push(t.tiles.floor);this.tiles.push(n)}}return e(s,[{key:"hasStairs",value:function(){for(var e=0;e<this.size.y;e++)for(var i=0;i<this.size.x;i++)if(this.tiles[e][i]===t.tiles.stairsDown||this.tiles[e][i]===t.tiles.stairsUp)return!0;return!1}},{key:"getDoorLocations",value:function(){for(var e=[],i=0;i<this.size.y;i++)for(var s=0;s<this.size.x;s++)this.tiles[i][s]===t.tiles.door&&e.push({x:s,y:i});return e}}],[{key:"areConnected",value:function(e,i){for(var s=e.getDoorLocations(),r=0;r<s.length;r++){var o=s[r];if(o.x+=e.pos.x,o.y+=e.pos.y,o.x-=i.pos.x,o.y-=i.pos.y,!(o.x<0||o.x>i.size.x-1||o.y<0||o.y>i.size.y-1)&&i.tiles[o.y][o.x]===t.tiles.door)return!0}return!1}}]),s}();
},{"./tiles":"B/l8"}],"+8F6":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Dungeon=void 0;var s=function(){function s(s,o){for(var i=0;i<o.length;i++){var e=o[i];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(s,e.key,e)}}return function(o,i,e){return i&&s(o.prototype,i),e&&s(o,e),o}}(),o=require("./room"),i=require("./tiles");function e(s,o){if(!(s instanceof o))throw new TypeError("Cannot call a class as a function")}var r=Math.floor,t=Math.random,a=Math.min,n=Math.max;function y(s,o){return r(t()*(o-s)+s)}function h(s){return s[r(t()*s.length)]}var x=exports.Dungeon=function(){function x(s,o){e(this,x),this.size={x:s,y:o},this.minRoomSize=5,this.maxRoomSize=15,this.maxNumRooms=50,this.maxRoomArea=150,this.addStairsUp=!0,this.addStairsDown=!0,this.rooms=[],this.roomGrid=[]}return s(x,[{key:"getStairs",value:function(){for(var s={up:null,down:null},o=0;o<this.rooms.length;o++){var e=this.rooms[o];if(e.hasStairs())for(var r=0;r<e.size.y;r++)for(var t=0;t<e.size.x;t++)e.tiles[r][t]===i.tiles.stairsUp?s.up={x:e.pos.x+t,y:e.pos.y+r}:e.tiles[r][t]===i.tiles.stairsUp&&(s.down={x:e.pos.x+t,y:e.pos.y+r})}return s}},{key:"generate",value:function(){this.rooms=[],this.roomGrid=Array(this.size.y);for(var s=0;s<this.size.y;s++){for(var e=Array(this.size.x),a=0;a<this.size.x;a++)e[a]=[];this.roomGrid[s]=e}var n=this.createRandomRoom();n.pos={x:r(this.size.x/2)-r(n.size.x/2),y:r(this.size.y/2)-r(n.size.y/2)},this.addRoom(n);for(var y=5*this.maxNumRooms;(this.maxNumRooms<=0||this.rooms.length<this.maxNumRooms)&&y-- >0;)this.generateRoom();for(var h=0;h<this.rooms.length;h++)for(var x=this.getPotentiallyTouchingRooms(this.rooms[h]),p=0;p<x.length;p++)o.Room.areConnected(this.rooms[h],x[p])||t<.2&&this.addDoor(this.findNewDoorLocation(this.rooms[h],x[p]));this.addStairsDown&&this.addStairs(i.tiles.stairsDown),this.addStairsUp&&this.addStairs(i.tiles.stairsUp)}},{key:"getFlattenedTiles",value:function(){for(var s=Array(this.size.y),o=0;o<this.size.y;o++){s[o]=Array(this.size.x);for(var i=0;i<this.size.x;i++)s[o][i]=null}for(var e=0;e<this.rooms.length;e++)for(var r=this.rooms[e],t=0;t<r.size.y;t++)for(var a=0;a<r.size.x;a++)0!==r.tiles[t][a]&&(s[t+r.pos.y][a+r.pos.x]={type:r.tiles[t][a],hasBeenSeen:!1});return s}},{key:"getCollisionMap",value:function(){for(var s=Array(this.size.y),o=0;o<this.size.y;o++){s[o]=Array(this.size.x);for(var e=0;e<this.size.x;e++)s[o][e]=0}for(var r=0;r<this.rooms.length;r++)for(var t=this.rooms[r],a=0;a<t.size.y;a++)for(var n=0;n<t.size.x;n++){var y=0;switch(t.tiles[a][n]){case i.tiles.wall:y=1;break;case i.tiles.stairsUp:y=2;break;case i.tiles.stairsDown:y=3}s[a+t.pos.y][n+t.pos.x]=y}return s}},{key:"roomIntersect",value:function(s,o){var i=s.pos.x,e=s.pos.y,r=s.size.x,t=s.size.y,a=o.pos.x,n=o.pos.y,y=o.size.x,h=o.size.y;return!(i+r<=a+1||i>=a+y-1||e+t<=n+1||e>=n+h-1)}},{key:"canFitRoom",value:function(s){if(s.pos.x<0||s.pos.x+s.size.x>this.size.x-1)return!1;if(s.pos.y<0||s.pos.y+s.size.y>this.size.y-1)return!1;for(var o=0;o<this.rooms.length;o++){var i=this.rooms[o];if(this.roomIntersect(s,i))return!1}return!0}},{key:"getPotentiallyTouchingRooms",value:function(s){for(var o=[],i=function(i,e,r){for(var t=r[e][i],a=0;a<t.length;a++)if(t[a]!==s&&o.indexOf(t[a])<0){var n=i-t[a].pos.x,y=e-t[a].pos.y;(n>0&&n<t[a].size.x-1||y>0&&y<t[a].size.y-1)&&o.push(t[a])}},e=s.pos.x+1;e<s.pos.x+s.size.x-1;e++)i(e,s.pos.y,this.roomGrid),i(e,s.pos.y+s.size.y-1,this.roomGrid);for(var r=s.pos.y+1;r<s.pos.y+s.size.y-1;r++)i(s.pos.x,r,this.roomGrid),i(s.pos.x+s.size.x-1,r,this.roomGrid);return o}},{key:"findNewDoorLocation",value:function(s,o){var i={x:-1,y:-1},e=-1;switch(s.pos.y===o.pos.y-s.size.y+1?e=0:s.pos.x===o.pos.x-s.size.x+1?e=1:s.pos.x===o.pos.x+o.size.x-1?e=2:s.pos.y===o.pos.y+o.size.y-1&&(e=3),e){case 0:i.x=y(r(n(o.pos.x,s.pos.x)+1),r(a(o.pos.x+o.size.x,s.pos.x+s.size.x)-1)),i.y=o.pos.y;break;case 1:i.x=o.pos.x,i.y=y(r(n(o.pos.y,s.pos.y)+1),r(a(o.pos.y+o.size.y,s.pos.y+s.size.y)-1));break;case 2:i.x=s.pos.x,i.y=y(r(n(o.pos.y,s.pos.y)+1),r(a(o.pos.y+o.size.y,s.pos.y+s.size.y)-1));break;case 3:i.x=y(r(n(o.pos.x,s.pos.x)+1),r(a(o.pos.x+o.size.x,s.pos.x+s.size.x)-1)),i.y=s.pos.y}return i}},{key:"findRoomAttachment",value:function(s){var o=h(this.rooms),i={x:0,y:0};switch(y(0,4)){case 0:i.x=y(o.pos.x-s.size.x+3,o.pos.x+o.size.x-2),i.y=o.pos.y-s.size.y+1;break;case 1:i.x=o.pos.x-s.size.x+1,i.y=y(o.pos.y-s.size.y+3,o.pos.y+o.size.y-2);break;case 2:i.x=o.pos.x+o.size.x-1,i.y=y(o.pos.y-s.size.y+3,o.pos.y+o.size.y-2);break;case 3:i.x=y(o.pos.x-s.size.x+3,o.pos.x+o.size.x-2),i.y=o.pos.y+o.size.y-1}return{position:i,target:o}}},{key:"addRoom",value:function(s){if(!this.canFitRoom(s))return!1;this.rooms.push(s);for(var o=s.pos.y;o<s.pos.y+s.size.y;o++)for(var i=s.pos.x;i<s.pos.x+s.size.x;i++){var e=this.roomGrid[o][i];e.push(s),this.roomGrid[o][i]=e}return!0}},{key:"addDoor",value:function(s){for(var o=this.roomGrid[s.y][s.x],e=0;e<o.length;e++){var r=o[e],t=s.x-r.pos.x,a=s.y-r.pos.y;r.tiles[a][t]=i.tiles.door}}},{key:"createRandomRoom",value:function(){var s=0,i=0,e=0;do{e=(s=y(this.minRoomSize,this.maxRoomSize))*(i=y(this.minRoomSize,this.maxRoomSize))}while(this.maxRoomArea>0&&e>this.maxRoomArea);return new o.Room(s,i)}},{key:"generateRoom",value:function(){for(var s=this.createRandomRoom(),o=150;o-- >0;){var i=this.findRoomAttachment(s);if(s.pos=i.position,this.addRoom(s)){this.addDoor(this.findNewDoorLocation(s,i.target));break}}}},{key:"addStairs",value:function(s){var o=null;do{o=h(this.rooms)}while(o.getDoorLocations().length>1||o.hasStairs());for(var e=[],r=1;r<o.size.y-2;r++)for(var t=1;t<o.size.x-2;t++)o.tiles[r][t]===i.tiles.floor&&o.tiles[r-1][t]!==i.tiles.door&&o.tiles[r+1][t]!==i.tiles.door&&o.tiles[r][t-1]!==i.tiles.door&&o.tiles[r][t+1]!==i.tiles.door&&e.push({x:t,y:r});var a=h(e);o.tiles[a.y][a.x]=s}}]),x}();
},{"./room":"U5Xy","./tiles":"B/l8"}],"BSXI":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=exports.keys=Object.freeze({left:37,up:38,right:39,down:40});
},{}],"hZZ8":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Level=void 0;var e=function(){function e(e,i){for(var s=0;s<i.length;s++){var t=i[s];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(i,s,t){return s&&e(i.prototype,s),t&&e(i,t),i}}(),i=require("./dungeon"),s=require("./keys"),t=require("./tiles");function r(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}var n=Math.floor,l=Math.abs,o=16,a=exports.Level=function(){function a(){r(this,a),this.dungeon=new i.Dungeon(100,100),this.dungeon.generate(),this.collisionMap=this.dungeon.getCollisionMap(),this.tiles=this.dungeon.getFlattenedTiles(),this.player={pos:{x:0,y:0},size:{x:12,y:12},speed:175,color:"#0CED13",onStairs:!0};var e=this.dungeon.getStairs();this.player.pos.x=e.up.x*o+o/2-this.player.size.x/2,this.player.pos.y=e.up.y*o+o/2-this.player.size.y/2}return e(a,[{key:"width",value:function(){return this.dungeon.size.x*o}},{key:"height",value:function(){return this.dungeon.size.y*o}},{key:"update",value:function(e,i){var r={x:0,y:0};s.keys.left in i&&(r.x-=this.player.speed*e),s.keys.right in i&&(r.x+=this.player.speed*e),s.keys.up in i&&(r.y-=this.player.speed*e),s.keys.down in i&&(r.y+=this.player.speed*e),this.player.pos=this.moveEntity(this.player.pos,this.player.size,r);for(var l=n((this.player.pos.x+this.player.size.x/2)/o),a=n((this.player.pos.y+this.player.size.y/2)/o),y=0,h=!1,p=this.dungeon.roomGrid[a][l],u=0;u<p.length;u++){var f=p[u],x=l-f.pos.x,d=a-f.pos.y;if(f.tiles[d][x]===t.tiles.stairsUp&&(h=!0,!this.player.onStairs)){y=-1;break}if(f.tiles[d][x]===t.tiles.stairsDown&&(h=!0,!this.player.onStairs)){y=1;break}}return this.player.onStairs=h,y}},{key:"isTileVisible",value:function(e,i,s,t,r){if("none"===e)return!0;if("room"===e){var n=this.dungeon.roomGrid[s][i];if(null!==n)for(var o=0;o<n.length;o++){var a=n[o];if(t>=a.pos.x&&t<a.pos.x+a.size.x&&r>=a.pos.y&&r<a.pos.y+a.size.y)return!0}}if("los"===e){if(i<0||i>=this.dungeon.size.x||t<0||t>=this.dungeon.size.x||s<0||s>=this.dungeon.size.y||r<0||r>=this.dungeon.size.y)return!0;for(var y=l(t-i),h=l(r-s),p=i<t?1:-1,u=s<r?1:-1,f=y-h;i!==t||s!==r;){if(1===this.collisionMap[s][i])return!1;var x=2*f;x>-h&&(f-=h,i+=p),x<y&&(f+=y,s+=u)}return!0}return!1}},{key:"draw",value:function(e,i,s,r){for(var l=n((this.player.pos.x+this.player.size.x/2)/o),a=n((this.player.pos.y+this.player.size.y/2)/o),y=n(s.x/o)-1,h=n(s.y/o)-1,p=(s.x%o+o)%o,u=(s.y%o+o)%o,f=-p-o,x=-u-o,d=e.width+o-p,c=e.height+o-u,v=h,g=x;g<c;v++,g+=o)if(!(v<0||v>=this.dungeon.size.y))for(var z=y,k=f;k<d;z++,k+=o)if(!(z<0||z>=this.dungeon.size.x)){var b=this.tiles[v][z];if(null!==b){var w=this.isTileVisible(r,l,a,z,v);if(w&&(b.HasBeenSeen=!0),b.HasBeenSeen){switch(b.type){case t.tiles.floor:case t.tiles.door:i.fillStyle=w?"#B8860B":"#705104";break;case t.tiles.wall:i.fillStyle=w?"#8B4513":"#61300D";break;case t.tiles.stairsDown:i.fillStyle="#7A5A0D";break;case t.tiles.stairsUp:i.fillStyle="#F2CD27"}i.fillRect(k,g,o,o)}}}i.fillStyle=this.player.color,i.fillRect(n(this.player.pos.x-s.x),n(this.player.pos.y-s.y),n(this.player.size.x),n(this.player.size.y))}},{key:"moveEntity",value:function(e,i,s){var r={x:e.x+s.x,y:e.y+s.y};if(s.x){var l=s.x>0?i.x:0,a=n((e.x+s.x+l)/o),y=n(e.y/o),h=Math.ceil((e.y+i.y)/o);if(h>=0&&y<this.dungeon.size.y&&a>=0&&a<this.dungeon.size.x)for(var p=y;p<h;p++)if(this.collisionMap[p][a]===t.tiles.wall){r.x=a*o-l+(s.x<0?o:0);break}}if(s.y){var u=s.y>0?i.y:0,f=n((e.y+s.y+u)/o),x=n(r.x/o),d=Math.ceil((r.x+i.x)/o);if(d>=0&&x<this.dungeon.size.x&&f>=0&&f<this.dungeon.size.y)for(var c=x;c<d;c++)if(this.collisionMap[f][c]===t.tiles.wall){r.y=f*o-u+(s.y<0?o:0);break}}return r}}]),a}();
},{"./dungeon":"+8F6","./keys":"BSXI","./tiles":"B/l8"}],"epB2":[function(require,module,exports) {
"use strict";var e=require("./level"),t=require("./keys"),n=Math.floor,i={};window.addEventListener("keydown",function(e){for(var n in t.keys)if(t.keys[n]===e.keyCode)return i[e.keyCode]=!0,e.preventDefault&&e.preventDefault(),!0},!1),window.addEventListener("keyup",function(e){for(var n in t.keys)if(t.keys[n]===e.keyCode)return delete i[e.keyCode],e.preventDefault&&e.preventDefault(),!0},!1);var o=[new e.Level],a=0,r={x:0,y:0},d="room",l=!1;function u(t){var d=o[a].update(t,i);-1===d?a>0&&a--:1===d&&(a===o.length-1&&o.push(new e.Level),a++);var l=document.getElementById("myCanvas"),u=o[a].player,y=u.pos.x+u.size.x/2,s=u.pos.y+u.size.y/2;r.x=n(y-l.width/2),r.y=n(s-l.height/2)}function y(){var e=document.getElementById("myCanvas"),t=e.getContext("2d");t.fillStyle="black",t.fillRect(0,0,e.width,e.height),o[a].draw(e,t,r,d),l&&(window.open(document.getElementById("myCanvas").toDataURL("image/png")),l=!1)}document.getElementById("resetBtn").addEventListener("click",function(){o=[new e.Level],a=0,r={x:0,y:0}}),document.getElementById("screenshotBtn").addEventListener("click",function(){l=!0});var s=Date.now();function v(){window.requestAnimationFrame(v);var e=Date.now(),t=(e-s)/1e3;s=e,u(t),y()}var c=document.getElementById("visibility");c.onchange=function(){d=c.options[c.selectedIndex].value},window.requestAnimationFrame(v);
},{"./level":"hZZ8","./keys":"BSXI"}]},{},["epB2"], null)